{% extends "blog/base.html" %}

<meta property="og:title" content="{{ article.title }}" />
<meta property="og:description" content="{{ article.body|truncatewords:25 }}" />
<meta property="og:image" content="{{ absolute_image_url }}" />
<meta property="og:url" content="{{ absolute_post_url }}" />
<meta property="og:type" content="article" />


{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>MindShiftWithAshe | Read </title>
    
    <link rel="stylesheet" href="../../static/css/blogpost.css">
    <link rel="stylesheet" href="../../static/css/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="../../static/css/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../static/useFont/css/all.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/fastbootstrap@2.2.0/dist/css/fastbootstrap.min.css" rel="stylesheet" integrity="sha256-V6lu+OdYNKTKTsVFBuQsyIlDiRWiOmtC8VQ8Lzdm2i4=" crossorigin="anonymous">
</head>

<body class="body">
  <!-- Navbar Section -->
  <nav class="navbar navbar-expand-lg bg-white position-sticky fixed-top mb-5">
      <div class="pl-3 container">
        <a class="navbar-brand fs-4"><span class="ms-madi-regular">MindShiftWithAshe</span></a>
        <button class="navbar-toggler shadow-none border-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="sidebar offcanvas sideback offcanvas-start" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
          <div class="offcanvas-header sideback border-bottom">
            <h5 class="offcanvas-title" id="offcanvasNavbarLabel"><span class="font">MindShiftWithAshe</span></h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>

          <div class="offcanvas-body">
            <ul class="navbar-nav justify-content-end flex-grow-1">
              <li class="nav-item my-4"><a class="nav-link" aria-current="page" href="{% url 'blog:home'%}">Home</a></li>
              <li class="nav-item my-4"><a class="nav-link" href="{% url 'blog:home'%}#videos">Videos</a></li>
              <li class="nav-item my-4"><a class="nav-link" href="{% url 'blog:home'%}#about">About</a></li>
              <li class="nav-item my-4"><a class="nav-link" href="{% url 'blog:home'%}#contact">Contact</a></li>
 <li class="nav-item my-4">
<!-- Donate Button -->
<li class="nav-item my-4">
  <button id="donateBtn" type="button"
    class="btn rounded-circle d-flex align-items-center justify-content-center"
    style="width:45px;height:45px;border:2px solid pink;color:pink;background:transparent;outline:none;">
    <i class="fas fa-hand-holding-heart"></i>
  </button>
</li>

<!-- Popup -->
<div id="donatePopup"
     style="position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:1050;">
  <div role="dialog" aria-modal="true" aria-labelledby="donateTitle"
       style="background:#fff;max-width:520px;width:92%;border-radius:16px;border:2px solid pink;box-shadow:0 10px 30px rgba(0,0,0,.2);">
    <div style="display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid #f5c2d5;">
      <h5 id="donateTitle" style="margin:0;">Support the Author ‚ù§Ô∏è</h5>
      <button id="donateCloseX" type="button" aria-label="Close"
              style="background:none;border:0;font-size:22px;line-height:1;cursor:pointer;">√ó</button>
    </div>

    <div style="padding:16px;">
      <p style="margin-bottom:8px;">If you enjoyed this article, you can support the author with a small donation.</p>
      <p style="margin:0 0 12px 0;">
        <strong>Bank Name:</strong> United Bank for Africa (UBA)<br>
        <strong>Account Name:</strong> Ashever Jocelyn¬†Terfa<br>
        <strong>Account Number:</strong>
        <span id="acctNo">2078897586</span>
        <button id="copyAcct" type="button"
                style="margin-left:8px;padding:4px 8px;border:1px solid #eee;background:#fafafa;border-radius:8px;cursor:pointer;">
          Copy
        </button>
      </p>
      <p style="margin:0;">Thank you for your kindness! üåü</p>
    </div>

    <div style="display:flex;gap:8px;justify-content:flex-end;padding:12px 16px;border-top:1px solid #f5c2d5;">
      <button id="donateCancel" type="button"
              style="padding:8px 14px;border:1px solid #ddd;background:#f8f9fa;border-radius:10px;cursor:pointer;">
        Cancel
      </button>
      <button id="donateOk" type="button"
              style="padding:8px 14px;border:0;background:pink;border-radius:10px;color:#000;cursor:pointer;">
        Got it
      </button>
    </div>
  </div>
</div>

<script>
(function(){
  var popup = document.getElementById('donatePopup');
  var openBtn = document.getElementById('donateBtn');
  var closeX = document.getElementById('donateCloseX');
  var cancel = document.getElementById('donateCancel');
  var ok = document.getElementById('donateOk');
  var copyBtn = document.getElementById('copyAcct');

  function openPopup(){ popup.style.display='flex'; document.body.style.overflow='hidden'; }
  function closePopup(){ popup.style.display='none'; document.body.style.overflow=''; }

  openBtn.addEventListener('click', openPopup);
  closeX.addEventListener('click', closePopup);
  cancel.addEventListener('click', closePopup);
  ok.addEventListener('click', closePopup);

  // Close when clicking the dark backdrop
  popup.addEventListener('click', function(e){ if (e.target === popup) closePopup(); });

  // ESC key closes
  document.addEventListener('keydown', function(e){ if (e.key === 'Escape' && popup.style.display==='flex') closePopup(); });

  // Copy account number
  if (copyBtn){
    copyBtn.addEventListener('click', function(){
      var txt = document.getElementById('acctNo').textContent.trim();
      navigator.clipboard.writeText(txt).then(function(){
        copyBtn.textContent = 'Copied!';
        setTimeout(function(){ copyBtn.textContent = 'Copy'; }, 1500);
      });
    });
  }
})();
</script>


            </ul>
          </div>
        </div>
      </div>
  </nav>

  <!-- Main Content Wrapper --> 
  <div class="container">
    <div class="row">
        <div class="col-md-8 main-pos">
            <!-- Blog title and content here -->
            <p class="playfair-display">{{article.title|upper}}</p>
            <div 
            class="post-image" 
            style="background-image: url('{{ article.image_file.url }}'); background-size: cover; background-position: center; width: 90%; height: 400px; position: relative;">
            <div type="button" class="credit">Credit</div>
        </div>
            <div class="post-icon d-flex">
<div class="i-color" style="display: flex; gap: 10px;">
  
    <!-- Email Share -->
<!-- Email Share -->
<a href="mailto:?subject={{ post.title|urlencode }}&body={{ request.build_absolute_uri|urlencode }}"
   target="_blank"
   title="Share via Email"
   style="text-decoration: none; color: inherit;">
  <i class="ri-mail-line" style="font-size: 1.5rem; color: #333;"></i>
</a>

    <!-- Whatsapp Share -->
<a href="https://api.whatsapp.com/send?text={{ post.title }} - {{ request.build_absolute_uri }}" 
   target="_blank" 
   title="Share on WhatsApp"
   style="text-decoration: none; color: inherit;">
    <i class="ri-whatsapp-line" style="color: #25D366;"></i>  <!-- WhatsApp green -->
</a>

<!-- Facebook -->
<a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}"
   target="_blank"
   title="Share on Facebook"
   style="text-decoration: none; color: inherit;">
  <i class="ri-facebook-circle-fill" style="color: #1877F2;"></i>
</a>

</div>

<div class="heart-icon d-flex align-items-center" style="cursor: pointer; gap: 2px;" id="like-btn" data-slug="{{ article.slug }}">
    <i class="ri-heart-3-line" id="like-icon" style="color: red; font-size: 1.5rem;"></i>
    <p id="like-count" style="margin: 0;">{{ article.likes }}</p>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const likeBtn = document.getElementById('like-btn');
    const likeIcon = document.getElementById('like-icon');
    const likeCount = document.getElementById('like-count');

    likeBtn.addEventListener('click', function () {
      const slug = likeBtn.dataset.slug;

      fetch(`/like/${slug}/`, {
        method: 'GET',
        headers: {
          'X-Requested-With': 'XMLHttpRequest'
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.liked) {
          likeCount.textContent = data.likes_count;
          likeIcon.classList.remove('ri-heart-3-line');
          likeIcon.classList.add('ri-heart-3-fill'); // solid heart icon
        }
        alert(data.message);
      });
    });
  });
</script>


            </div>

            <!-- Blog content starts -->
      <div id="article-body" class="blog-paragraph" 
     style="max-width: 750px; margin: 40px auto; padding: 0 15px; font-size: 17px; line-height: 1.7; color: #333; font-family: Georgia, serif;">
    <div class="time-posted mt-5">
        <h4 style="font-size: 14px; color: #777; margin-bottom: 20px;">
            {{ article.created|date:"F jS, Y" }}
        </h4>
    </div>
    <div style="margin-top: 25px;">
        {{ article.body|safe }}
    </div>
</div>

            <!-- Blog content ends -->

            <!-- css for the bible pop up -->
             <style>
.verse-popup {
  position: absolute;
  max-width: 300px;
  background: #fefefe;
  padding: 12px;
  border: 1px solid #ddd;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  border-radius: 6px;
  z-index: 999;
  font-size: 14px;
  line-height: 1.4;
}
.bible-verse {
  color: #2a6fb5;
  cursor: pointer;
  text-decoration: underline dotted;
}
</style>


<!-- js script for it -->

<script>
document.addEventListener("DOMContentLoaded", function () {
  const container = document.getElementById("article-body");
  const regex = /\b(?:[1-3]\s)?[A-Za-z]+(?:\s)?\d{1,3}:\d{1,3}\b/g;

  // Walk the DOM and wrap references in spans
  function walk(node) {
    if (node.nodeType === 3) {
      const matches = [...node.textContent.matchAll(regex)];
      if (matches.length === 0) return;

      const frag = document.createDocumentFragment();
      let lastIndex = 0;

      matches.forEach((match, i) => {
        const { index } = match;
        const before = node.textContent.slice(lastIndex, index);
        const matched = match[0];

        if (before) frag.appendChild(document.createTextNode(before));

        const span = document.createElement("span");
        span.className = "bible-verse";
        span.dataset.ref = matched;
        span.textContent = matched;
        frag.appendChild(span);

        lastIndex = index + matched.length;
      });

      const after = node.textContent.slice(lastIndex);
      if (after) frag.appendChild(document.createTextNode(after));

      node.parentNode.replaceChild(frag, node);
    } else if (node.nodeType === 1 && node.nodeName !== "SCRIPT" && node.nodeName !== "STYLE") {
      [...node.childNodes].forEach(walk);
    }
  }

  walk(container);

  // Fetch and show popup
  function showPopup(text, anchor) {
    let popup = document.createElement("div");
    popup.className = "verse-popup";
    popup.textContent = text;
    document.body.appendChild(popup);

    const rect = anchor.getBoundingClientRect();
    popup.style.top = `${rect.bottom + window.scrollY + 5}px`;
    popup.style.left = `${rect.left + window.scrollX}px`;

    function removePopup() {
      popup.remove();
    }

    anchor.addEventListener("mouseleave", removePopup, { once: true });
    anchor.addEventListener("click", removePopup, { once: true }); // For mobile
  }

  function fetchVerse(el) {
    const ref = el.dataset.ref;
    fetch(`/get-bible-verse?ref=${encodeURIComponent(ref)}`)
      .then(res => res.json())
      .then(data => {
        if (data.text) {
          showPopup(`${data.reference}: ${data.text}`, el);
        }
      });
  }

  document.querySelectorAll(".bible-verse").forEach(el => {
    el.addEventListener("mouseenter", () => fetchVerse(el));
    el.addEventListener("click", (e) => {
      e.preventDefault();
      fetchVerse(el);
    });
  });
});
</script>


            <!-- Comment Section -->

 <!-- Comment Section -->
<div class="comment-section container my-5">
  <h4 class="text-center playfair-display mb-4">Leave a Comment</h4>

  <form id="comment-form" method="POST" class="mx-auto" style="max-width: 700px;">
    {% csrf_token %}
    <div class="mb-3">
      <input type="text" name="name" class="form-control" placeholder="Your Name" required style="border:1px solid #f8c8dc;">
    </div>
    <div class="mb-3">
      <input type="email" name="email" class="form-control" placeholder="Your Email" required style="border:1px solid #f8c8dc;">
    </div>
    <div class="mb-3">
      <textarea name="body" class="form-control" rows="4" placeholder="Write your comment..." required style="border:1px solid #f8c8dc;"></textarea>
    </div>
    <div class="text-center">
      <button type="submit" class="btn" style="background-color:#f8c8dc;color:white;">Submit</button>
      <div id="spinner" class="spinner-border" style="display:none;color:#f8c8dc;" role="status"></div>
    </div>
    <div id="comment-success" class="text-success text-center mt-3" style="display:none;">Thanks for your comment!</div>
  </form>

  <div id="new-comment-section" class="mt-4"></div>

  <!-- Existing Comments -->
  <div class="mt-5">
    <h5 class="text-center playfair-display">{{ total_comments }} Comment{{ total_comments|pluralize }}</h5>
    {% for comment in comments %}
    <div class="border rounded p-3 my-3" style="border:1px solid #f8c8dc;">
      <div class="d-flex justify-content-between">
        <strong>{{ comment.name }}</strong>
        <small>{{ comment.created|date:"d.m.Y" }}</small>
      </div>
      <p class="mt-2 mb-0">{{ comment.body }}</p>
      <!-- <button class="btn btn-sm" style="border:1px solid #f8c8dc;color:#f8c8dc;" data-bs-toggle="modal" data-bs-target="#replyModal{{ comment.id }}">Reply</button> -->
    </div>
    {% endfor %}
  </div>
</div>


<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('comment-form');
    const spinner = document.getElementById('spinner');
    const commentSection = document.getElementById('new-comment-section');
    const successMsg = document.getElementById('comment-success');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      spinner.style.display = 'inline-block';
      successMsg.style.display = 'none';

      const formData = new FormData(form);

      try {
        const response = await fetch(window.location.href, {
          method: 'POST',
          headers: {
            'X-Requested-With': 'XMLHttpRequest',
            'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
          },
          body: formData
        });

        const data = await response.json();
        spinner.style.display = 'none';

        if (data.success) {
          const newComment = `
            <div class="border rounded p-3 my-3 fade-in">
              <div class="d-flex justify-content-between">
                <strong>${data.name}</strong>
                <small>${data.created}</small>
              </div>
              <p class="mt-2 mb-0">${data.body}</p>
            </div>
          `;

          commentSection.insertAdjacentHTML('afterbegin', newComment);
          form.reset();
          successMsg.style.display = 'block';
        }
      } catch (error) {
        spinner.style.display = 'none';
        alert('Something went wrong. Please try again.');
        console.error(error);
      }
    });
  });
</script>

<style>
  .fade-in {
    animation: fadeIn 0.6s ease-in;
  }

  @keyframes fadeIn {
    from {opacity: 0;}
    to {opacity: 1;}
  }
</style>

           
</div>


    
    




        
        <!-- Related Content Section -->
        <div class="col-md-4 related-posts">
          <h4>Related Videos</h4>
          {% if similar_vlog_filtered %}
              {% for vlog in similar_vlog_filtered %}
              <div class="body-one text-center">
                  <div class="blog-one py-4">
                      <video id="vid" class="vid-one" width="350px" controls>
                          <source src="{{vlog.video_file.url}}" type="video/mp4">
                      </video>  
                  </div>
                  <h6 class="remove-m">{{vlog.title|upper}}</h6>
                  <p>{{vlog.description|safe}}</p>
                  <div class="blog-icon d-flex">
                      <div><i class="ri-share-line"></i></div>
                      <div class="text-dark d-flex">
                          <i class="ri-heart-3-line"></i>
                          <p class="mt-1">{{vlog.like}}</p>
                      </div>
                  </div>
              </div>
              {% endfor %}
          {% else %}
              <p>This post does not have any related videos.</p>
          {% endif %}
      
          <h5 class="text-post">Related Articles</h5>
          {% if similar_articles_filtered %}
              {% for x in similar_articles_filtered %}
              <div class="mt-3 p-2 backg text-center">
                  <h6><a href="{% url 'blog:detail-page' slug=x.slug %}" style="color: inherit; text-decoration: none;">{{ x.title|upper }}</a></h6>
                  <p>{{x.body|safe|truncatewords:20}}</p>
              </div>
              {% endfor %}
          {% else %}
              <p>This post does not have any related articles.</p>
          {% endif %}
      </div>
      

<!-- older and new posts -->
<!-- Older and Newer Posts Navigation -->
<div class="text-center my-4">
  <div class="navigations d-flex justify-content-center gap-4 flex-wrap" 
       style="display:flex; justify-content:center; gap:20px; flex-wrap:wrap;">

    <!-- Newer -->
    {% if previous_article %}
    <div class="newerPost d-flex align-items-center" 
         style="display:flex; align-items:center;">
      <a href="{% url 'blog:detail-page' slug=previous_article.slug %}" 
         class="d-flex align-items-center text-decoration-none"
         style="display:flex; align-items:center; color:pink; text-decoration:none;">
        <i class="fa-solid fa-arrow-left" style="color:pink;"></i>
        <p class="mb-0 ms-2" style="margin:0 0 0 8px; color:pink;">Newer Posts</p>
      </a>
    </div>
    {% else %}
    <div class="newerPost d-flex align-items-center" 
         style="display:flex; align-items:center; color:#ccc;">
      <i class="fa-solid fa-arrow-left" style="color:#ccc;"></i>
      <p class="mb-0 ms-2" style="margin:0 0 0 8px; color:#ccc;">Newer Posts</p>
    </div>
    {% endif %}

    <!-- Older -->
    {% if next_article %}
    <div class="olderPost d-flex align-items-center" 
         style="display:flex; align-items:center;">
      <a href="{% url 'blog:detail-page' slug=next_article.slug %}" 
         class="d-flex align-items-center text-decoration-none"
         style="display:flex; align-items:center; color:pink; text-decoration:none;">
        <p class="mb-0 me-2" style="margin:0 8px 0 0; color:pink;">Older Posts</p>
        <i class="fa-solid fa-arrow-right" style="color:pink;"></i>
      </a>
    </div>
    {% else %}
    <div class="olderPost d-flex align-items-center" 
         style="display:flex; align-items:center; color:#ccc;">
      <p class="mb-0 me-2" style="margin:0 8px 0 0; color:#ccc;">Older Posts</p>
      <i class="fa-solid fa-arrow-right" style="color:#ccc;"></i>
    </div>
    {% endif %}

  </div>
</div>

<!-- older and new post ends here -->

    </div> <!-- Closing the row div -->
  </div> <!-- Closing the container div -->
</body>
</html>

{% endblock %}
